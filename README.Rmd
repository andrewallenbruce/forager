---
output: github_document
editor_options: 
  markdown: 
    wrap: 72
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse  = TRUE,
  echo      = TRUE, 
  message   = FALSE, 
  warning   = FALSE,
  error     = TRUE,
  comment   = "#>",
  dpi       = 300, 
  out.width = "100%",
  fig.path  = "man/figures/README-"
)
```

# forager <a href="#"><img src="man/figures/logo.svg" align="right" width="25%" min-width="120px"/></a>

> ***Forager** (noun)*
>
> *A person that goes from place to place searching for things that they
> can eat or use.*[^1]

> ***Ager** (noun)*
>
> *A person that calls from place to place searching for payment before
> insurance can refuse.*[^2]

<br>

<!-- badges: start -->

![GitHub R package version](https://img.shields.io/github/r-package/v/andrewallenbruce/forager?style=flat-square&logo=R&label=Package&color=%23192a38)
[![R-CMD-check](https://github.com/andrewallenbruce/forager/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/andrewallenbruce/forager/actions/workflows/R-CMD-check.yaml)
[![License: MIT](https://img.shields.io/badge/license-MIT-blue.svg)](https://choosealicense.com/licenses/mit/)
[![Code Size](https://img.shields.io/github/languages/code-size/andrewallenbruce/forager.svg)](https://github.com/andrewallenbruce/forager)
[![last commit](https://img.shields.io/github/last-commit/andrewallenbruce/forager.svg)](https://github.com/andrewallenbruce/forager/commits/master)
[![Codecov test coverage](https://codecov.io/gh/andrewallenbruce/forager/branch/master/graph/badge.svg)](https://app.codecov.io/gh/andrewallenbruce/forager?branch=master)

<!-- badges: end -->

## Installation

You can install the development version of `forager` from [GitHub](https://github.com/) with:

``` r
# install.packages("pak")
pak::pak("andrewallenbruce/forager")
```

```{r setup, echo=TRUE, message=FALSE, warning=FALSE}
library(tidyverse)
library(clock)
library(forager)
library(fuimus)
```

## The Lifecycle of a Claim 

```{r, echo=TRUE, warning=FALSE}
(x <- mock_claims(15000))
```

<br>

```{r echo=TRUE}
long <- x |> 
  pivot_longer(
    cols      = starts_with("date"), 
    names_to  = "date_type", 
    names_prefix = "date_",
    values_to = "date") |> 
  mutate(
    date_type = fct_relevel(
      date_type, 
      "service", 
      "release",
      "submission", 
      "acceptance", 
      "adjudication", 
      "reconciliation"), 
    days = as.numeric(lead(date) - date),
    days = lag(days, order_by = date),
    .by = claimid) |> 
  arrange(claimid, date_type)

long
```

<br>

```{r}
x <- long |> 
  pivot_wider(
    names_from = date_type,
    names_glue = "{.value}_{date_type}",
    values_from = c(date, days)
  ) |> 
  remove_quiet() |> 
  rowwise() |> 
  mutate(days_in_ar = if_else(
      !is.na(date_reconciliation), 
      as.numeric((date_reconciliation - date_service)),
      as.numeric((date_adjudication - date_service))
  )) |> 
  ungroup() |> 
  nest(dates = c(
    date_release, 
    date_submission, 
    date_acceptance, 
    date_adjudication, 
    date_reconciliation
    )
  ) |>
  bin_aging(days_in_ar)
x
```


```{r echo=TRUE}
x |> 
  group_by(
    year = year(date_service),
    month = month(date_service),
    payer
  ) |>
  summarise(
    claims             = n(), 
    balance            = sum_na(balance),
    avg_release        = mean_na(days_release), 
    avg_submission     = mean_na(days_submission),
    avg_acceptance     = mean_na(days_acceptance),
    avg_adjudication   = mean_na(days_adjudication),
    avg_reconciliation = mean_na(days_reconciliation),
    avg_days_in_ar     = mean_na(days_in_ar),
    .groups = "drop") |> 
  arrange(payer) |>
  select(year, month, payer, claims, balance, avg_days_in_ar)
```

<br>

```{r echo=TRUE}
x |> 
  group_by(
    year = get_year(date_service),
    qtr = quarter(date_service),
    payer
    ) |>
  summarise(
    claims             = n(), 
    balance            = sum_na(balance),
    avg_release        = mean_na(days_release), 
    avg_submission     = mean_na(days_submission),
    avg_acceptance     = mean_na(days_acceptance),
    avg_adjudication   = mean_na(days_adjudication),
    avg_reconciliation = mean_na(days_reconciliation),
    avg_days_in_ar     = mean_na(days_in_ar),
    .groups = "drop") |> 
  arrange(payer) |>
  select(year, qtr, payer, claims, balance, avg_days_in_ar)
```

## Days in AR Calculation

> Monthly

```{r echo=TRUE}
tibble(
  date = date_build(2024, 1:12),
  gct  = rpois(12, 250000:400000),
  earb = rpois(12, 290000:400000)
  ) |> 
  avg_dar(
    date, 
    gct, 
    earb, 
    dart = 35,
    by = "month")
```

<br>

> Quarterly

```{r echo=TRUE}
tibble(
  date = date_build(2024, 1:12),
  gct  = rpois(12, 250000:400000),
  earb = rpois(12, 285500:400000)
  ) |> 
  avg_dar(
    date, 
    gct, 
    earb, 
    dart = 35,
    by = "quarter")
```


## Code of Conduct

Please note that the `forager` project is released with a [Contributor
Code of
Conduct](https://andrewallenbruce.github.io/forager/CODE_OF_CONDUCT.html).
By contributing to this project, you agree to abide by its terms.

[^1]: <https://dictionary.cambridge.org/dictionary/english/forager>

[^2]: Me.

