---
output: github_document
editor_options: 
  markdown: 
    wrap: 72
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse  = TRUE,
  echo      = TRUE, 
  message   = FALSE, 
  warning   = FALSE,
  error     = TRUE,
  comment   = "#>",
  dpi       = 150, 
  out.width = "100%",
  fig.path  = "man/figures/README-"
)
```

# forager <a href="https://andrewallenbruce.github.io/forager/"><img src="man/figures/logo.svg" align="right" height="200"/></a>

> ***Forager** (noun)*
>
> *A person that goes from place to place searching for things that they
> can eat or use.*[^1]

> ***Ager** (noun)*
>
> *A person that calls from place to place searching for payment before
> insurance can refuse.*[^2]

<br>

<!-- badges: start -->

[![R-CMD-check](https://github.com/andrewallenbruce/forager/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/andrewallenbruce/forager/actions/workflows/R-CMD-check.yaml)
[![License:
MIT](https://img.shields.io/badge/license-MIT-blue.svg)](https://choosealicense.com/licenses/mit/)
[![code
size](https://img.shields.io/github/languages/code-size/andrewallenbruce/forager.svg)](https://github.com/andrewallenbruce/forager)
[![last
commit](https://img.shields.io/github/last-commit/andrewallenbruce/forager.svg)](https://github.com/andrewallenbruce/forager/commits/master)
[![Codecov test coverage](https://codecov.io/gh/andrewallenbruce/forager/branch/master/graph/badge.svg)](https://app.codecov.io/gh/andrewallenbruce/forager?branch=master)
<!-- badges: end -->

## Installation

You can install the development version of `forager` from
[GitHub](https://github.com/) with:

``` r
# install.packages("pak")
pak::pak("andrewallenbruce/forager")
```

```{r, echo=TRUE, warning=FALSE, message=FALSE}
library(tidyverse)
library(clock)
library(forager)
library(fuimus)
```

## Foundation: Time Measurement

Everything in a Healthcare RCM workflow is built upon the bedrock of time measurement. 

   *  Task $a$ is created at time $t$.
   *  Subtask $a_1$ is assigned at time $t_1$ to responsible party $x_1$.
   *  Subtask $a_2$ is assigned at time $t_2$ to responsible party $x_2$.
   *  So on, and so forth until...
   *  Task $a_i$ is completed at time $t_i$.
   
Measuring the amount of time between each step becomes crucial in identifying workflow issues.

### Example: The Lifecycle of a Claim 

   * **Provider Lag**: Days between *Date of Service* and *Date of Release*
   * **Billing Lag**:  Days between *Date of Release* and *Date of Submission*
   * **Acceptance Lag**:  Days between *Date of Submission* and *Date of Acceptance*
   * **Payment Lag**: Days between *Date of Acceptance* and *Date of Adjudication*
   * **Days in AR**: Days between *Date of Release* and *Date of Adjudication*

<br>

```{r, echo=TRUE, warning=FALSE}
x <- forager::generate_data(15000)
x |> head(n = 10)
```
<br>

```{r echo=TRUE}
x |> 
  pivot_longer(
    cols      = starts_with("date"), 
    names_to  = "date_type", 
    values_to = "date") |> 
  mutate(days_diff = lead(date) - date,
         .by = claim_id)
```
<br>

```{r echo=TRUE}
x_days <- x |> 
  count_days(date_of_service, date_of_release, prov_lag) |> 
  count_days(date_of_release, date_of_submission, bill_lag) |> 
  count_days(date_of_submission, date_of_acceptance, proc_lag) |> 
  count_days(date_of_submission, date_of_adjudication, payer_lag) |> 
  count_days(date_of_release, date_of_adjudication, dar)
```


```{r echo=TRUE}
x_days |> 
  group_by(month = date_month_factor(date_of_service)) |> 
  summarise(
    n_claims = n(), 
    balance = sum(balance),
    prov_lag = mean(prov_lag), 
    bill_lag = mean(bill_lag),
    proc_lag = mean(proc_lag),
    payer_lag = mean(payer_lag),
    dar = mean(dar), 
    .groups = "drop")
```

<br>

```{r echo=TRUE}
x_days |> 
  group_by(qtr = quarter(date_of_service)) |> 
  summarise(
    n_claims = n(), 
    balance = sum(balance),
    prov_lag = mean(prov_lag), 
    bill_lag = mean(bill_lag),
    proc_lag = mean(proc_lag),
    payer_lag = mean(payer_lag),
    dar = mean(dar), 
    .groups = "drop")
```


## Aging Calculation

```{r echo=TRUE}
x |> 
  count_days(date_of_service, date_of_adjudication, dar) |> 
  group_by(aging_bin = cut(dar, breaks = seq(0, 500, by = 30))) |> 
  summarise(
    n_claims = n(),
    balance = roundup(sum(balance)), 
    .groups = "drop")
```

```{r}
x |> 
  bin_aging(date_of_service)
```


## Days in AR Monthly Calculation

```{r echo=TRUE}
tibble(
  date = date_build(2024, 1:12),
  gct = abs(rnorm(12, c(365000.567, 169094.46, 297731.74), c(2:3))),
  earb = abs(rnorm(12, c(182771.32, 169633.64, 179347.72), c(2:3)))) |> 
  avg_dar(
    date, 
    gct, 
    earb, 
    dart = 35)
```

<br>

## Days in AR Quarterly Calculation

```{r results='asis', echo=TRUE}
tibble(
  date = date_build(2024, 1:12),
  gct = abs(rnorm(12, c(365000.567, 169094.46, 297731.74), c(2:3))),
  earb = abs(rnorm(12, c(182771.32, 169633.64, 179347.72), c(2:3)))) |> 
  avg_dar(date, 
          gct, 
          earb, 
          dart = 35, 
          period = "quarter")
```


## Code of Conduct

Please note that the `forager` project is released with a [Contributor
Code of
Conduct](https://andrewallenbruce.github.io/forager/CODE_OF_CONDUCT.html).
By contributing to this project, you agree to abide by its terms.

[^1]: <https://dictionary.cambridge.org/dictionary/english/forager>

[^2]: Me.

