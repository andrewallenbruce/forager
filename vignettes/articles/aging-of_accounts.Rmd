---
title: "Aging of Accounts"
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse  = FALSE,
  echo      = TRUE,
  message   = FALSE, 
  warning   = FALSE,
  error     = TRUE,
  comment   = "#>",
  dpi       = 600, 
  out.width = "100%"
  )

library(forager)
library(dplyr)
library(tidyr)
library(gt)
```


An account is a *billable episode of care*. It begins to age once it is billed to an insurance company or patient. These outstanding accounts are monitored by age in 30-day increments (0 - 30, 31 - 60, 61 - 90, and so forth.) AR departments monitor the number of accounts outstanding, the dollar amount in each 30-day increment (sometimes called “bins” or “buckets”), and the responsible parties. 

As well, aging should be broken down by many metrics, such as Provider, Patient, Insurance Types (Commercial, Primary, Secondary, Worker’s Compensation, Managed Care), Facility, Diagnosis/Procedure code, Specialty, etc. The older the account or the longer the account remains unpaid, the less likely it will be reimbursed.

Most claims are originally billed to insurance and, until the insurance makes a payment, the responsibility for the payment continues to be with the insurance payer. After the payer makes or denies a payment (with no just cause for an appeal), the responsibility for the balance of goes to the patient (to be sent an invoice) or the physician (to be written off.)


```{r}
binned <- bin_aging(
  df = load_ex("aging_ex"),
  date = dos) |>
  select(
    dos:ins_class,
    dar:aging_bin)

binned
```

```{r}
binned |>
  arrange(aging_bin) |>
  summarise(n_claims = n(),
            balance = sum(charges),
            .by = aging_bin) |>
  mutate(pct_claims = n_claims / sum(n_claims),
         pct_balance = balance / sum(balance)) |>
  gt(rowname_col = "aging_bin") |>
  opt_table_font(font = google_font(name = "JetBrains Mono")) |>
  fmt_percent(columns = pct_claims:pct_balance, decimals = 0) |>
  fmt_currency(columns = balance, decimals = 0) |>
  fmt_number(columns = n_claims, decimals = 0) |>
  opt_stylize() |>
  cols_label(n_claims = "Claims", balance = "Charges") |>
  cols_move_to_start(c(n_claims, pct_claims, balance, pct_balance)) |>
  cols_merge(c(n_claims, pct_claims), pattern = "{1} ({2})") |>
  cols_merge(c(balance, pct_balance), pattern = "{1} ({2})") |>
  tab_header(title = "Aging Report", ) |>
  tab_options(heading.align = "left",
              quarto.disable_processing = TRUE)
```


```{r}
binned |>
  arrange(aging_bin, ins_name) |>
  summarise(
    n_claims = n(),
    balance = sum(charges),
    .by = c(aging_bin, ins_name)
  ) |>
  mutate(pct_claims = n_claims / sum(n_claims),
         pct_balance = balance / sum(balance)) |>
  gt(groupname_col = "aging_bin", rowname_col = "ins_name") |>
  opt_table_font(font = google_font(name = "JetBrains Mono")) |>
  fmt_percent(columns = pct_claims:pct_balance) |>
  fmt_currency(columns = balance, decimals = 0) |>
  fmt_number(columns = n_claims, decimals = 0) |>
  cols_label(n_claims = "Claims", balance = "Charges") |>
  cols_merge(c(n_claims, pct_claims), pattern = "{1} ({2})") |>
  cols_merge(c(balance, pct_balance), pattern = "{1} ({2})") |>
  opt_stylize()
```


```{r}
binned |>
  arrange(ins_name, aging_bin) |>
  summarise(
    n_claims = n(),
    balance = sum(charges),
    .by = c(aging_bin, ins_name)
  ) |>
  mutate(pct_claims = n_claims / sum(n_claims),
                pct_balance = balance / sum(balance),
                .by = ins_name) |>
  gt(groupname_col = "aging_bin", rowname_col = "ins_name") |>
  opt_table_font(font = google_font(name = "JetBrains Mono")) |> 
  fmt_percent(columns = pct_claims:pct_balance) |> 
  fmt_currency(columns = balance) |> 
  fmt_number(columns = n_claims, decimals = 0) |> 
  cols_label(n_claims = "Claims", balance = "Charges") |>
  cols_merge(c(n_claims, pct_claims), pattern = "{1} ({2})") |>
  cols_merge(c(balance, pct_balance), pattern = "{1} ({2})") |>
  opt_stylize()
```
